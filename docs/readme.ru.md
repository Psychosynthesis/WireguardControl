## Web-интерфейс для wireguard
Простой web-интерфейс для VPN-wireguard с возможностью как использовать уже созданные конфиги, так и настраивать свои.

### Возможности
 - Добавление клиентов через web-интерфейс
 - Отслеживание статуса в интерфейсе
 - Перезагрузка Wireguard через web-интерфейс
 - Работа с несколькими `.conf`-файлами (интерфейсами)
 - Написан на JS, полностью открытый интефрейс и код, можно править на месте без сборки

### Недостатки
 - Для применения конфига (*например после добавления клиента*) требуется перезагрузка Wireguard
 - Крайне слабая парольная защита (в текущей версии это лишь запрет отрисовки интерфейса на стороне клиента через JS)
 - Данные клиентов (pubkey, presharedkey, etc) хранятся без какого-либо шифрования
 - Требует установленной NodeJS, а также, желательно PM2, чтобы поддерживать автоматический перезапуск

### Подготовка
Для работы нужен сам Wireguard и NodeJS. Гайд ниже для Ubuntu.
```bash
sudo apt install wireguard
```
Самый простой способ установить NodeJS нужной версии это [NVM](https://github.com/nvm-sh/nvm). Данный проект тестировался на NodeJS v.20.10, но вероятно будет работать и на более старых версиях (вероятно на 12-й работать должен), поэтому можете попробовать просто поставить NodeJS через `apt`. Далее пример команд для установки NVM:
```bash
wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

source ~/.bashrc
```
Проверить, что `nvm` установлен можно командой `nvm -v`. После этого ставим рекомендуемую версию ноды:
```bash
nvm install 20.10.0
```

### Установка
Клонирем репозиторий в удобную вам папку (здесь для примера это `/var/wg-control`):
```bash
git clone https://github.com/Psychosynthesis/WireguardControl.git /var/wg-control
```

Переходим в созданную папку и устанавливаем зависимости:
```bash
cd /var/wg-control

npm i
```

### Запуск
Переходим в ранее созданную папку и запускаем сервер:
```bash
cd /var/wg-control

npm run start
```
Не забудьте добавить адрес IP-адрес вашего сервера внутри VPN в `allowedOrigins` в файле `config.json`, а также убедитесь, что `webServerPort`, используемый данным сервером по умолчанию (`8877`) открыт в firewall (если у вас включена блокировка портов).

После этого, интерфейс будет доступен в браузере по адресу вашего сервера, например `http://10.8.2.1:9876/`.
Если вы делали это до того как вручную создали первого клиента для Wireguard, то добавлять в `allowedOrigins` нужно ваш публичный IP и не блокируемый вашим файрволом `webServerPort`.

Дефольный пароль: `Pssword` \
***Обратите внимание! В текущей версии крайне примитивная парольная защита.***

Далее следует добавить скрипт сервера в автозагрузку. Есть несколько способов сделать это, но самый удобный и простой это воспользоваться инструментом `pm2`, он, помимо прочего, позволяет распараллеливать нагрузку, а также следить за потреблением памяти.

```bash
npm install pm2 -g
cd /var/wg-control && pm2 start ecosystem.json --watch --ignore-watch="node_modules"
pm2 startup
pm2 save
```
Теперь для мониторинга состояния сервера достаточно запустить `pm2 monit`.

### Особенности
Дополнительные данные о клиентах хранятся в папке `.data` в файле `peers.json` в следующем формате:
```JSON
{
  "PEER1_PUBLIC_KEY":{"name":"PEER1_NAME"},
  "PEER2_PUBLIC_KEY":{"name":"PEER2_NAME"}
}
```

При загрузке `Wireguard-Control` ищет все доступные конфиги в `/etc/wireguard` и парсит их, а затем загружает в память, поэтому при запросе статуса система не обращается к файлам конфигурации.

### Дополнительно

[Пример конфигурации Wireguard для корпоративной сети](./sample.conf.md)
