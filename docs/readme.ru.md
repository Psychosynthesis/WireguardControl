## Wireguard Control — Web-интерфейс для wireguard
Простой web-интерфейс для VPN-wireguard с возможностью как использовать уже созданные конфиги, так и настраивать свои.

### Возможности и особенности
 - Добавление клиентов через web-интерфейс
 - Отслеживание статуса в интерфейсе
 - Перезагрузка Wireguard через web-интерфейс
 - Работа с несколькими `.conf`-файлами (интерфейсами)
 - Написан на JS, максимально простой и открытый интефрейс, можно править всё что необходимо прямо на месте без сборки
 - Не использует никакие базы данных (данные хранятся в JSON)

### Недостатки
 - Для применения конфига (*например после добавления клиента*) требуется перезагрузка Wireguard
 - Данные клиентов (pubkey, presharedkey, etc) хранятся без какого-либо шифрования
 - Требует установленной NodeJS, а также, желательно PM2, чтобы поддерживать автоматический перезапуск

### Подготовка
Для работы нужен сам Wireguard и NodeJS. Гайд ниже для Ubuntu.
```bash
sudo apt install wireguard
```
Самый простой способ установить NodeJS нужной версии это [NVM](https://github.com/nvm-sh/nvm). Данный проект тестировался на NodeJS v.20.10, но вероятно будет работать и на более старых версиях (вероятно на 12-й работать должен), поэтому можете попробовать просто поставить NodeJS через `apt`. Далее пример команд для установки NVM:
```bash
wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

source ~/.bashrc
```
Проверить, что `nvm` установлен можно командой `nvm -v`. После этого ставим рекомендуемую версию ноды:
```bash
nvm install 20.10.0
```

### Установка
Клонирем репозиторий в удобную вам папку (здесь для примера это `/var/wg-control`):
```bash
git clone https://github.com/Psychosynthesis/WireguardControl.git /var/wg-control
```

Переходим в созданную папку и устанавливаем зависимости:
```bash
cd /var/wg-control

npm i
```

### Запуск
Переходим в ранее созданную папку и запускаем сервер:
```bash
cd /var/wg-control

npm run start
```
Не забудьте указать свои настройки в файле `config.example.json` (при первом запуске он будет переименован в `config.json`). Вам следует указать ваш дефольный WG-интерфейс и добавить IP вашего сервера (в сети VPN) в `allowedOrigins`. Также убедитесь, что `webServerPort`, используемый этим сервером по умолчанию (`8877`), открыт в брандмауэре (если у вас включена блокировка портов).

**ОБЯЗАТЕЛЬНО ИЗМЕНИТЕ КЛЮЧ ШИФРОВАНИЯ ПО УМОЛЧАНИЮ!**

Вы можете сгенерировать себе случайный ключ прямо в bash, например следующими способами:
```bash
# C помощью openssl:
openssl rand -base64 16
# C использованием /dev/urandom и base64:
head -c 16 /dev/urandom | base64
```
Либо выполните в консоли разработчика в браузере, открыв веб-интерфейс Wireguard Control:
```javascript
// Библиотека forge используется в public\index.html для шифрования
forge.util.encode64(forge.random.getBytes(16));
```

Далее следует добавить скрипт сервера в автозагрузку. Есть несколько способов сделать это, но самый удобный и простой это воспользоваться инструментом `pm2`, он, помимо прочего, позволяет распараллеливать нагрузку, а также следить за потреблением памяти.

```bash
npm install pm2 -g
cd /var/wg-control && pm2 start ecosystem.json --watch --ignore-watch="node_modules"
pm2 startup
pm2 save
```
Теперь для мониторинга состояния сервера достаточно запустить `pm2 monit`.

### Особенности
Дополнительные данные о клиентах хранятся в папке `.data` в файле `peers.json` в следующем формате:
```JSON
{
  "PEER1_PUBLIC_KEY":{"name":"PEER1_NAME"},
  "PEER2_PUBLIC_KEY":{"name":"PEER2_NAME"}
}
```

При загрузке `Wireguard-Control` ищет все доступные конфиги в `/etc/wireguard` и парсит их, а затем загружает в память, поэтому при запросе статуса система не обращается к файлам конфигурации.

### Дополнительно

[Пример конфигурации Wireguard для корпоративной сети](./sample.conf.md)
